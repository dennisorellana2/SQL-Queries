--SQL Code
--Dennis Orellana

--CHECK DATA TABLE with the first 5 rows
SELECT *
FROM FIRST_GOP_DEBATE LIMIT 5;

-- Check Row Count
SELECT count(*) num_rows
FROM FIRST_GOP_DEBATE;

-- SYSIBM.SYSTABLES 
 SELECT  NAME, CREATOR, CTIME, COLCOUNT
   FROM  SYSIBM.SYSTABLES
  WHERE  CREATOR ='PMM36106'; 
  
-- SYSIBM.SYSCOLUMNS
SELECT  NAME, TBNAME, TBCREATOR, COLTYPE, NULLS, LENGTH
  FROM  SYSIBM.SYSCOLUMNS 
 WHERE  TBCREATOR='PMM36106'
   AND  TBNAME='FIRST_GOP_DEBATE';
   
   -- 4a Candidate is mentioned count 
   SELECT COUNT (CANDIDATE), CANDIDATE
   FROM FIRST_GOP_DEBATE
   GROUP BY CANDIDATE
   ORDER BY  COUNT (CANDIDATE) DESC;
   
   -- 4b A query that returns the following 5 columns
SELECT CANDIDATE as "Candidate Name", 
    COUNT(CASE WHEN SENTIMENT='Negative' THEN 1 END) AS "Negative",
    COUNT(CASE WHEN SENTIMENT='Positive' THEN 1 END) AS "Positive",
    COUNT(CASE WHEN SENTIMENT='Neutral' THEN 1 END) AS "Neutral",
    COUNT(*) AS "Total"

FROM FIRST_GOP_DEBATE
    
GROUP BY CANDIDATE;
 
 
 --------------4c Four more queries discovery in the dataset----------------------------
 
 --4c Query 1 
 --Discover about Abortion
SELECT CANDIDATE, SUBJECT_MATTER, COUNT(*) 
FROM FIRST_GOP_DEBATE
WHERE SUBJECT_MATTER LIKE  'A%'

GROUP BY CANDIDATE,  SUBJECT_MATTER
HAVING COUNT(*) > 5
ORDER BY COUNT(*)  DESC;


--4c Query 2
-- Display Candidate with Sentiment and Subject of the Matter Tweets

SELECT  CANDIDATE as "Candidate Name",  
    COUNT(CASE WHEN SENTIMENT='Negative' THEN 1 END) AS "Negative",
    COUNT(CASE WHEN SENTIMENT='Positive' THEN 1 END) AS "Positive",
    COUNT(CASE WHEN SENTIMENT='Neutral' THEN 1 END) AS "Neutral",
    COUNT(*) AS "Total",
   SUBJECT_MATTER

FROM FIRST_GOP_DEBATE
    
    WHERE SUBJECT_MATTER IN 
    (SELECT DISTINCT SUBJECT_MATTER FROM  FIRST_GOP_DEBATE)
GROUP BY CANDIDATE, SUBJECT_MATTER
HAVING COUNT(*) > 300
ORDER BY COUNT(*)  DESC;


--4c Query 3
-- Mentioned Donald Trump and Subject of the Matter Tweets

SELECT CANDIDATE, SUBJECT_MATTER, COUNT(*) 
FROM FIRST_GOP_DEBATE
WHERE CANDIDATE= 'Donald Trump'

GROUP BY CANDIDATE,  SUBJECT_MATTER
ORDER BY COUNT(*)  DESC;


--4c Query 4
-- Subject of the Matter with Positive Tweets
SELECT CANDIDATE, SUBJECT_MATTER, SENTIMENT,  COUNT(*) 
FROM FIRST_GOP_DEBATE
WHERE SENTIMENT IN 
    (SELECT SENTIMENT FROM FIRST_GOP_DEBATE
    WHERE SENTIMENT LIKE 'P%' AND CANDIDATE = 'Donald Trump')

GROUP BY CANDIDATE,  SUBJECT_MATTER, SENTIMENT
HAVING COUNT(*) > 200
ORDER BY COUNT(*)  DESC;

 
 -- End of Script